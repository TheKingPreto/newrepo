<main>
    <h1><%= title %></h1>

    <%- detailHTML %>

    <%- messages() %>

    
    <section id="reviews-section">
        <h2>Client Reviews</h2>

        <% if (locals.loggedIn) { %>
            <div id="add-review">
                <h3>Add a New Review</h3>
                
                <% if (errors) { %>
                    <ul class="notice">
                        <% errors.array().forEach(error => { %>
                            <li><%= error.msg %></li>
                        <% }) %>
                    </ul>
                <% } %>

                <form id="reviewForm" action="/inv/add-review" method="post">
                    <label for="review_text">Comment:</label>
                    <textarea id="review_text" name="review_text" rows="4" required><%= locals.review_text || '' %></textarea>
                    
                    <input type="hidden" name="inv_id" value="<%= vehicle.inv_id %>">
                    
                    <button type="submit">Publish Review</button>
                </form>
            </div>
        <% } else { %>
            <p>You must <a href="/account/login">login</a> to leave a review.</p>
        <% } %>

        <div id="reviews-list">
            <% if (reviews && reviews.length > 0) { %>
                <% reviews.forEach(review => { %>
                    <div class="review-item">
                        <p class="review-meta">
                            <span class="reviewer-name">
                                **<%= review.account_firstname.substring(0, 1) %>. <%= review.account_lastname %>**
                            </span> 
                            reviewed on: 
                            <span class="review-date">
                                 <%= review.review_date.toLocaleDateString('en-US', { dateStyle: 'long' }) %>
                            </span>
                        </p>
                        <p class="review-text"><%= review.review_text %></p>
                        
                        <% if (locals.loggedIn && locals.accountData.account_id === review.account_id) { %>
                            <div class="review-actions">
                                <a href="/account/review/edit/<%= review.review_id %>" title="Edit your review">Edit</a>
                                
                                <form action="/account/review/delete" method="post" onsubmit="return confirm('Are you sure you want to delete this review?');">
                                    <input type="hidden" name="review_id" value="<%= review.review_id %>">
                                    <button type="submit" class="delete-btn">Delete</button>
                                </form>
                            </div>
                        <% } %>
                    </div>
                <% }) %>
            <% } else { %>
                <p>There are no reviews for this vehicle yet. Be the first!</p>
            <% } %>
        </div>
    </section>
</main>